<?php
        ini_set("memory_limit","100M");
	require_once("config.php");
	require_once("../".$mpdirectory."/rss_fetch.inc");
	require_once("parseRSS.php");
	$t=getdate();
	$today=date('Y-m-d',$t[0]);

        $category = array(0 => 'All',1 => 'Autos',2 => 'Comedy',3 => 'Education',4 => 'Entertainment', 5 => 'Film', 6 => 'Gaming', 7 => 'Howto', 8 => 'News',9 => 'Nonprofits', 10 => 'People', 11 => 'Pets', 12 => 'Science',13 => 'Sports', 14 => 'Travel');

        $date = date("Y_m_d_H_i_s");
        $tablename = $date."_week100";
        $query = "create table $tablename ( id INT NOT NULL AUTO_INCREMENT,PRIMARY KEY(id),category VARCHAR(13),video_id VARCHAR(11))";
        $vresult = mysql_query($query) or die(" ". mysql_error());


        for($i=0; $i < 15; $i++){
        	if($i == 0){
          	  	$ca = "?v=2&time=this_week";
        	}else{
			$ca ="_".$category[$i]."?v=2&time=this_week";
        	}
		$numvideos = 100;
		$maxIndex = $numvideos-49;
		for ($index=1; $index<=$maxIndex; $index+=50)//index=1,51,101..
		{
		        $url = "http://gdata.youtube.com/feeds/api/standardfeeds/most_viewed$ca&max-results=50&start-index=$index";
			$rss = fetch_rss($url);
			foreach ($rss->items as $item) 
			{
				$yt_url = $item['link'];
				$ytID = substr($yt_url,31,11);//Return part of a string.31 is a start point, 11 is length.
				$query = "insert into $tablename values ('','$category[$i]','$ytID')";
				$result = mysql_query($query) or die(" ". mysql_error());
			} // foreach ($rss->items as $item) 
		} // for ($index=1; $index<=51; $index+=50)
	}
 ?>
